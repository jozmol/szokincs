<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiejt√©s Gyakorl√≥</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-top: 20px;
            color: #333;
        }
        
        header {
            background: linear-gradient(to right, #e52d27, #b31217);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }

        .settings-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .settings-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: center;
        }

        .select-wrapper {
            position: relative;
            min-width: 200px;
        }

        .word-count-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #2196F3;
            border-radius: 8px;
            background: white;
            color: #333;
            font-size: 1rem;
            cursor: pointer;
        }

        .start-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            background: #3d8b40;
            transform: scale(1.05);
        }

        .practice-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .word-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .chinese-word {
            font-size: 4rem;
            margin-bottom: 10px;
            color: #e52d27;
            font-weight: bold;
        }
        
        .pinyin {
            font-size: 2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .tts-info {
            background-color: #e3f2fd;
            padding: 10px;
            margin: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            border-left: 4px solid #2196F3;
        }
        
        .meaning {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 30px;
        }
        
        .recording-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .recording-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .recording-btn:hover {
            background: #3d8b40;
            transform: scale(1.05);
        }
        
        .recording-btn.recording {
            background: #e52d27;
            animation: pulse 1.5s infinite;
        }
        
        .recording-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .recognition-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .feedback.good {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .feedback.needs-work {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .feedback.perfect {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .listen-btn {
            background: #2196F3;
            color: white;
        }

        .next-btn {
            background: #FF9800;
            color: white;
        }

        .new-session-btn {
            background: #607D8B;
            color: white;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
        }
        
        .progress {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }
        
        .recording-status {
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
        }

        .audio-visualizer {
            width: 100%;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .chinese-word {
                font-size: 3rem;
            }
            
            .pinyin {
                font-size: 1.5rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 250px;
            }

            .settings-row {
                flex-direction: column;
                gap: 10px;
            }

            .select-wrapper {
                width: 100%;
            }

            .recognition-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Pronunciation Practice</h1>
            <div class="subtitle">Practice pronouncing English words</div>
        </header>
        
        <div class="tts-info">
            üîä Click "Start Recording", speak the word, then click "Analyze"<br>
            üîä ÁÇπÂáª"ÂºÄÂßãÂΩïÈü≥"ÔºåËØ¥Âá∫ÂçïËØçÔºåÁÑ∂ÂêéÁÇπÂáª"ÂàÜÊûê"
        </div>

        <div class="progress hidden" id="progress-section">
            <div id="progress">0/0</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <div class="content">
            <div class="settings-section" id="settings-section">
                <div class="settings-title">
                    üéØ Choose how many words to practice
                </div>
                <div class="settings-row">
                    <div class="select-wrapper">
                        <select class="word-count-select" id="word-count-select">
                            <option value="5">5 words</option>
                            <option value="7" selected>7 words</option>
			    <option value="14" selected>10 words</option>
			    // <option value="0" selected>All words</option>
                        </select>
                    </div>
                    <button class="start-btn" id="start-btn">
                        üöÄ Start exercise
                    </button>
                </div>
                <div class="practice-info" id="practice-info">
                    Total words: <span id="total-words">All</span> words
                </div>
            </div>

            <div class="word-section hidden" id="word-section">
                <div class="chinese-word" id="chinese-word">***</div>
                <div class="pinyin" id="pinyin">***</div>
                <div class="meaning" id="meaning">***</div>
            </div>
            
            <div class="recording-section hidden" id="recording-section">
                <div class="recognition-controls">
                    <button class="recording-btn" id="record-btn">
                        üé§ Start Recording
                    </button>
                    <button class="recording-btn" id="stop-btn" disabled>
                        ‚èπÔ∏è Stop Recording
                    </button>
                    <button class="recording-btn" id="analyze-btn" disabled>
                        üîç Analyze
                    </button>
                </div>
                
                <canvas class="audio-visualizer" id="audio-visualizer"></canvas>
                
                <div class="recording-status" id="recording-status">
                    Click "Start Recording", speak, then "Analyze"
                </div>
                
                <div class="feedback" id="feedback"></div>
            </div>
            
            <div class="controls hidden" id="controls">
                <button class="control-btn listen-btn" id="listen-btn">
                    üîä Listen English
                </button>
                <button class="control-btn next-btn" id="next-btn">
                   ‚û°Ô∏è Next word
                </button>
                <button class="control-btn new-session-btn" id="new-session-btn">
                    üîÑ New exercise
                </button>
            </div>
        </div>
    </div>

    <script>
        // SZ√ìT√ÅR
        const fullWordDictionary = [
            { english: "thank you", pinyin: "thank you", meaning: "Ë∞¢Ë∞¢" },
            	{ english: "good day", pinyin: "good day", meaning: "‰Ω†Â•Ω" },
           	{ english: "I love you", pinyin: "I love you", meaning: "ÊàëÁà±‰Ω†" },
            	{ english: "hello", pinyin: "hello", meaning: "‰Ω†Â•Ω" },
            	{ english: "water", pinyin: "water", meaning: "Ê∞¥" },
            	{ english: "mother", pinyin: "mother", meaning: "Â¶àÂ¶à" },
            	{ english: "friend", pinyin: "friend", meaning: "ÊúãÂèã" },
	    	{ english: "breakfast", pinyin: "breakfast", meaning: "Êó©È§ê" },
		{  english: "lunch", pinyin: "lunch", meaning: "ÂçàÈ§ê"},
	{ english: "dinner", pinyin: "dinner", meaning: "ÊôöÈ§ê"},
	{ english: "soup", pinyin: "soup", meaning: "Ê±§"},
	{ english: "salad", pinyin: "salad", meaning: "Ê≤ôÊãâ"},
	{ english: "sandwich", pinyin: "sandwich", meaning: "‰∏âÊòéÊ≤ª"},
	{ english: "hamburger", pinyin: "hamburger", meaning: "Ê±âÂ†°", },
{meaning: "Êä´Ëê®", hungarian: "pizza", pinyin: "pizza", english: "pizza", category: "etelek" },
{ meaning: "ÊÑèÂ§ßÂà©Èù¢", hungarian: "spagetti", pinyin: "spaghetti", english: "spaghetti", category: "etelek" },
{ meaning: "Á±≥È•≠", hungarian: "rizs", pinyin: "rice", english: "rice", category: "etelek" },
{ meaning: "Èù¢Êù°", hungarian: "t√©szta", pinyin: "noodles", english: "noodles", category: "etelek" },
{ meaning: "È•∫Â≠ê", hungarian: "gomb√≥c", pinyin: "dumpling", english: "dumpling", category: "etelek" },
{ meaning: "ÂåÖÂ≠ê", hungarian: "g≈ëz√∂lt zsemle", pinyin: "steamed bun", english: "steamed bun", category: "etelek" },
{ meaning: "È¶íÂ§¥", hungarian: "g≈ëz√∂lt keny√©r", pinyin: "steamed bread", english: "steamed bread", category: "etelek" },
{ meaning: "ËõãÁ≥ï", hungarian: "torta", pinyin: "cake", english: "cake", category: "etelek" },
{ meaning: "È•ºÂπ≤", hungarian: "keksz", pinyin: "cookie", english: "cookie", category: "etelek" },
{ meaning: "Â∑ßÂÖãÂäõ", hungarian: "csokol√°d√©", pinyin: "chocolate", english: "chocolate", category: "etelek" },
{ meaning: "ÂÜ∞Ê∑áÊ∑ã", hungarian: "fagylalt", pinyin: "ice cream", english: "ice cream", category: "etelek" },
{ meaning: "Á≥ñÊûú", hungarian: "cukorka", pinyin: "candy", english: "candy", category: "etelek" },
{ meaning: "ËãπÊûú", hungarian: "alma", pinyin: "apple", english: "apple", category: "etelek" },
{ meaning: "È¶ôËïâ", hungarian: "ban√°n", pinyin: "banana", english: "banana", category: "etelek" },
{ meaning: "Ê©ôÂ≠ê", hungarian: "narancs", pinyin: "orange", english: "orange", category: "etelek" },
{ meaning: "ËçâËéì", hungarian: "eper", pinyin: "strawberry", english: "strawberry", category: "etelek" },
{ meaning: "Ëë°ËêÑ", hungarian: "sz≈ël≈ë", pinyin: "grape", english: "grape", category: "etelek" },
{ meaning: "Ë•øÁìú", hungarian: "g√∂r√∂gdinnye", pinyin: "watermelon", english: "watermelon", category: "etelek" },
{ meaning: "Ë•øÁ∫¢Êüø", hungarian: "paradicsom", pinyin: "tomato", english: "tomato", category: "etelek" },
{ meaning: "ËÉ°ËêùÂçú", hungarian: "s√°rgar√©pa", pinyin: "carrot", english: "carrot", category: "etelek" },
{ meaning: "ÂúüË±Ü", hungarian: "burgonya", pinyin: "potato", english: "potato", category: "etelek" },
{ meaning: "Ê¥ãËë±", hungarian: "hagyma", pinyin: "onion", english: "onion", category: "etelek" },
{ meaning: "Â§ßËíú", hungarian: "fokhagyma", pinyin: "garlic", english: "garlic", category: "etelek" },
{ meaning: "ÁâõÂ•∂", hungarian: "tej", pinyin: "milk", english: "milk", category: "etelek" },
{ meaning: "ÊûúÊ±Å", hungarian: "gy√ºm√∂lcsl√©", pinyin: "juice", english: "juice", category: "etelek" },
{ meaning: "ÂèØ‰πê", hungarian: "k√≥la", pinyin: "cola", english: "cola", category: "etelek" },
{ meaning: "ÁüøÊ≥âÊ∞¥", hungarian: "√°sv√°nyv√≠z", pinyin: "mineral water", english: "mineral water", category: "etelek" },
{ meaning: "Á∫¢ÈÖí", hungarian: "v√∂r√∂sbor", pinyin: "red wine", english: "red wine", category: "etelek" },
{ meaning: "ÁôΩÈÖí", hungarian: "szeszes ital", pinyin: "liquor", english: "liquor", category: "etelek" },
{ meaning: "È∏°Â∞æÈÖí", hungarian: "kokt√©l", pinyin: "cocktail", english: "cocktail", category: "etelek" },
{ meaning: "Â®ÅÂ£´Âøå", hungarian: "whisky", pinyin: "whisky", english: "whisky", category: "etelek" },
{ meaning: "‰ºèÁâπÂä†", hungarian: "vodka", pinyin: "vodka", english: "vodka", category: "etelek" }




        ];

        let currentWordIndex = 0;
        let selectedWords = [];
        let selectedWordCount = 7;
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let audioContext = null;
        let analyser = null;
        let microphone = null;

        // DOM elemek
        const settingsSection = document.getElementById('settings-section');
        const wordSection = document.getElementById('word-section');
        const recordingSection = document.getElementById('recording-section');
        const controlsSection = document.getElementById('controls');
        const progressSection = document.getElementById('progress-section');
        const chineseWordElement = document.getElementById('chinese-word');
        const pinyinElement = document.getElementById('pinyin');
        const meaningElement = document.getElementById('meaning');
        const recordButton = document.getElementById('record-btn');
        const stopButton = document.getElementById('stop-btn');
        const analyzeButton = document.getElementById('analyze-btn');
        const listenButton = document.getElementById('listen-btn');
        const nextButton = document.getElementById('next-btn');
        const newSessionButton = document.getElementById('new-session-btn');
        const feedbackElement = document.getElementById('feedback');
        const progressElement = document.getElementById('progress');
        const progressFill = document.getElementById('progress-fill');
        const recordingStatus = document.getElementById('recording-status');
        const startButton = document.getElementById('start-btn');
        const wordCountSelect = document.getElementById('word-count-select');
        const visualizer = document.getElementById('audio-visualizer');

        // INICIALIZ√ÅL√ÅS
        function init() {
            console.log("üéØ Initializing pronunciation practice...");
            updatePracticeInfo();
            
            // Esem√©nykezel≈ëk
            startButton.addEventListener('click', startPractice);

            recordButton.addEventListener('click', startRecording);
            stopButton.addEventListener('click', stopRecording);

            analyzeButton.addEventListener('click', analyzeRecording);
            listenButton.addEventListener('click', speakEnglish);
            
            nextButton.addEventListener('click', () => {
                currentWordIndex = (currentWordIndex + 1) % selectedWords.length;
                displayWord();
		setTimeout(async () => {
        	try {
            	await speakEnglish();    // V√°rjuk meg az angol v√©g√©t
            	await speakPinyin();     // Ut√°na j√∂het a k√≠nai
       		} catch (error) {
            console.error('Hiba:', error);
        }
    }, 300);

            });

            newSessionButton.addEventListener('click', () => {

                settingsSection.classList.remove('hidden');
                wordSection.classList.add('hidden');
                recordingSection.classList.add('hidden');
                controlsSection.classList.add('hidden');
                progressSection.classList.add('hidden');

            });

            wordCountSelect.addEventListener('change', () => {
                selectedWordCount = parseInt(wordCountSelect.value);
            });
        }

        // FELV√âTEL IND√çT√ÅSA
        async function startRecording() {
            try {
                console.log("üé§ Starting recording...");
                recordingStatus.textContent = "üîÑ Accessing microphone...";
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        sampleRate: 16000,
                        channelCount: 1,
                        echoCancellation: true,
                        noiseSuppression: true
                    } 
                });
                
                // Audio kontextus
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                
                microphone.connect(analyser);
                analyser.fftSize = 256;
                
                // Vizualiz√°ci√≥
                visualizeAudio();
                visualizer.style.display = 'block';
                
                // MediaRecorder
                audioChunks = [];
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    console.log("‚úÖ Recording stopped");
                    recordingStatus.textContent = "‚úÖ Recording ready for analysis";
                    analyzeButton.disabled = false;
                    visualizer.style.display = 'none';

                };
                
                mediaRecorder.start();
                isRecording = true;
                
                // UI friss√≠t√©se
                recordButton.disabled = true;
                stopButton.disabled = false;
                analyzeButton.disabled = true;
                recordButton.classList.add('recording');
                recordingStatus.textContent = "üî¥ Recording... Speak now!";
                
            } catch (error) {
                console.error("‚ùå Recording error:", error);
                recordingStatus.textContent = "‚ùå Microphone access denied";
                feedbackElement.innerHTML = "Please allow microphone access and try again";
                feedbackElement.className = 'feedback needs-work';
                feedbackElement.style.display = 'block';
            }
        }

        // FELV√âTEL LE√ÅLL√çT√ÅSA
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();

                isRecording = false;
                
                recordButton.disabled = false;
                stopButton.disabled = true;
                recordButton.classList.remove('recording');
                recordingStatus.textContent = "‚èπÔ∏è Recording stopped";


                if (mediaRecorder.stream) {
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                }
            }


        }

        // AUDIO VIZUALIZ√ÅCI√ì
        function visualizeAudio() {
            if (!analyser) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            const canvasCtx = visualizer.getContext('2d');
            
            function draw() {
                if (!isRecording) return;
                
                requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                
                canvasCtx.fillStyle = 'white';
                canvasCtx.fillRect(0, 0, visualizer.width, visualizer.height);
                
                const barWidth = (visualizer.width / bufferLength) * 2.5;
                let barHeight;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    barHeight = dataArray[i] / 2;
                    canvasCtx.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
                    canvasCtx.fillRect(x, visualizer.height - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }
            
            draw();
        }

      // FONETIKUS SZ√ìT√ÅR - B√ÅRMILYEN SORRENDBEN LEHET
const phoneticDictionary = {
    // Angol szavak fonetikus v√°ltozatai
    	"hello": ["helo", "helou", "halo", "hellou", "ellow"],
    	"thank you": ["tenk ju", "sank ju", "thank yu", "tenk you", "sank you"],
    	"good day": ["gud dei", "gud day", "gud dey", "gud d√©j"],
    	"i love you": ["ai lav ju", "ay lov you", "i lav yu", "ai lav u", "aj lav ju"],
    	"water": ["voter", "vater", "woter", "vata", "vad√∂"],
    	"mother": ["mader", "mather", "moter"],
    	"friend": ["frend", "frind", "freind", "frynd"],
    	"breakfast":["brekfast", "brekfest"],
  	"lunch":["lancs", "lanch", "l√∂nch", "loncs"],
   	"dinner": ["diner","dine","dinner"],
   	"soup": ["sup", "sz√∫p", "s√∫p"],
   	"salad": ["salad","salat","szal√°d"],
	"sandwich": ["sandvich","sendvics"],
   	"hamburger":["hamb√∂rger", "hamborg√∂r", "hamgurg√∂","hemb√∂rger"],
	"pizza": ["piza","pidza","p√≠za"],
	"spaghetti": ["spagedi", "spagetti"],
	"rice": ["r√°jz","rajs"],
	"noodles": ["nidels","nidls", "nyidls"],
	"dumpling": ["damlin", "dampling"],	
	"steamed bun": ["stimt ban", "stimtban"],
	"steamed bread": ["stimt bred", "stimtbred"],
	"cake": ["kek", "k√©k"],
	"cookie": ["kuki", "k√∫k√≠"],
	"chocolate": ["shokolad", "shokolat"],
	"ice cream": ["ajs crim", "√°jsz kr√≠m", "ays crem", "ajsz krim"],
	"candy": ["kendi","cendi"],
	"apple": ["apl", "epl"],
	"banana": ["banana", "b√°n√°na"],
	"orange": ["oradzs", "orandzs", "oranj"],
	"strawberry": ["straberi", "styraberri"],
	"grape": ["gr√©p","grep"]
//watermelon
//tomato
//carrot
//potato
//onion
//garlic
//milk
//juice
//cola
//mineral water
//red wine
//liquor
//cocktail
//whisky
//vodka


    
    // Magyar szavak - ezeket NEM fogadja el
   // "k√∂sz√∂n√∂m": ["kosonom", "kesenem", "kosonem"],
   // "szia": ["sia", "sija", "sya"],
  //  "j√≥ napot": ["jo napot", "yo napot", "jo napot"],
  //  "v√≠z": ["viz", "veez", "viz"],
  //  "anya": ["anya", "ania", "anya"],
  //  "bar√°t": ["barat", "baraat", "barat"]
};

// FONETIKUS √ñSSZEHASONL√çT√ì FUNKCI√ì
function phoneticCompare(spokenText, targetWord) {
    // Alapvet≈ë valid√°ci√≥
    if (!spokenText || spokenText.trim().length < 2) {
        return { match: false, score: 5, type: 'too_short' };
    }
    
    if (spokenText.length > 50) {
        return { match: false, score: 10, type: 'too_long' };
    }
    
    const spokenClean = spokenText.toLowerCase().trim();
    const targetClean = targetWord.toLowerCase().trim();
    
    // ‚ö†Ô∏è MINDIG ELLEN≈êRIZZ√úK, HOGY A C√âL SZ√ì L√âTEZIK-E
    if (!phoneticDictionary[targetClean]) {
        console.warn(`üö® Target word "${targetClean}" not in phonetic dictionary - using ULTRA STRICT mode`);
        return ultraStrictCompare(spokenClean, targetClean);
    }
    
    // 4. R√âSZBENI EGYEZ√âS
    const similarity = calculateSimilarity(spokenClean, targetClean);
    if (similarity > 0.7) {
        return { 
            match: true, 
            score: Math.floor(60 + similarity * 25), 
            type: 'partial' 
        };
    }
    
    // 5. NINCS EGYEZ√âS
    return { match: false, score: 30, type: 'no_match' };
}

// HI√ÅNYZ√ì MAGYAR DETEKT√ÅL√ì FUNKCI√ì
function detectHungarian(text) {
    const hungarianWords = ["k√∂sz√∂n√∂m", "szia", "j√≥ napot", "v√≠z", "anya", "bar√°t", "igen", "nem", "k√©rem"];
    const hungarianPatterns = [/sz/g, /gy/g, /ty/g, /ly/g, /ny/g, /zs/g, /cs/g];
    const hungarianVowels = [/√°/g, /√©/g, /√≠/g, /√≥/g, /√∂/g, /≈ë/g, /√∫/g, /√º/g, /≈±/g];
    
    // 1. Magyar szavak keres√©se
    for (let word of hungarianWords) {
        if (text.includes(word)) {
            console.log(`üõë Hungarian word detected: ${word}`);
            return true;
        }
    }
    
    // 2. Magyar speci√°lis m√°ssalhangz√≥k
    let hungarianConsonants = 0;
    for (let pattern of hungarianPatterns) {
        const matches = text.match(pattern);
        if (matches) hungarianConsonants += matches.length;
    }
    
    // 3. Magyar √©kezetes bet≈±k
    let hungarianVowelsCount = 0;
    for (let pattern of hungarianVowels) {
        const matches = text.match(pattern);
        if (matches) hungarianVowelsCount += matches.length;
    }
    
    // Ha van magyar speci√°lis bet≈±, akkor magyar
    if (hungarianConsonants > 1 || hungarianVowelsCount > 0) {
        console.log(`üõë Hungarian characters detected`);
        return true;
    }
    
    return false;
}

// HI√ÅNYZ√ì HASONL√ìS√ÅG SZ√ÅM√çT√ì FUNKCI√ì
function calculateSimilarity(str1, str2) {
    if (str1 === str2) return 1;
    
    const longer = str1.length > str2.length ? str1 : str2;
    const shorter = str1.length > str2.length ? str2 : str1;
    
    // Egyszer≈± karakterenk√©nti hasonl√≥s√°g
    let matches = 0;
    const minLength = Math.min(str1.length, str2.length);
    
    for (let i = 0; i < minLength; i++) {
        if (str1[i] === str2[i]) matches++;
    }
    
    return matches / longer.length;
}

// ANALYZE RECORDING 
async function analyzeRecording() {
    recordingStatus.textContent = "üîç Analyzing pronunciation...";
    
    // Szimul√°lt felismert sz√∂veg (k√©s≈ëbb val√≥di speech recognition-re cser√©lni...)
    const currentWord = selectedWords[currentWordIndex].english;
    const recognitionOptions = [
        currentWord,                      // t√∂k√©letes
        phoneticDictionary[currentWord] ? phoneticDictionary[currentWord][0] : currentWord, // fonetikus
       // "k√∂sz√∂n√∂m",                       // magyar
        currentWord.slice(0, 3),          // r√©szleges
        "wrong word"                      // hib√°s
    ];
    
    const spokenText = recognitionOptions[Math.floor(Math.random() * recognitionOptions.length)];
    
    setTimeout(() => {
        try {
            const result = phoneticCompare(spokenText, currentWord);
            displayPhoneticResult(result, spokenText, currentWord);
            recordingStatus.textContent = "‚úÖ Analysis complete!";
        } catch (error) {
            console.error("Analysis error:", error);
            recordingStatus.textContent = "‚ùå Analysis failed";
        }
    }, 1000);
}

// FONETIKUS EREDM√âNY MEGJELEN√çT√âSE
function displayPhoneticResult(result, spokenText, targetWord) {
    let message, details, color, suggestion;
    
    if (result.type === 'hungarian') {
        message = "‚ùå Please speak English";
        details = `You said: <strong>"${spokenText}"</strong> (Hungarian)<br>Should be: <strong>"${targetWord}"</strong> (English)`;
        color = "#e52d27";
        suggestion = "üí° Please speak in English, not Hungarian";
    } else if (result.type === 'perfect') {
        message = "‚úÖ Perfect!";
        details = `Excellent pronunciation!<br>You said: <strong>"${spokenText}"</strong>`;
        color = "#4CAF50";
        suggestion = "üéâ Great job! Continue to the next word";
    } else if (result.type === 'phonetic') {
        message = "‚úÖ Good!";
        details = `Good pronunciation!<br>You said: <strong>"${spokenText}"</strong><br>Target: <strong>"${targetWord}"</strong>`;
        color = "#4CAF50";
        suggestion = "üëç Well done! Your pronunciation is understandable";
    } else if (result.type === 'partial') {
        message = "‚ö†Ô∏è Almost!";
        details = `Close, but needs improvement<br>You said: <strong>"${spokenText}"</strong><br>Target: <strong>"${targetWord}"</strong>`;
        color = "#ff9800";
        suggestion = "üîä Listen to the pronunciation again and try once more";
    } else {
        // NINCS EGYEZ√âS - "PR√ìB√ÅLD √öJRA"
        message = "üîÑ Try Again";
        details = `Pronunciation needs practice<br>You said: <strong>"${spokenText}"</strong><br>Target: <strong>"${targetWord}"</strong>`;
        color = "#ff9800";
        suggestion = "üëÇ Listen carefully to the word and try pronouncing it again";
    }
    
    feedbackElement.innerHTML = `
        <div style="font-size: 1.5em; color: ${color}; margin-bottom: 10px; font-weight: bold;">
            ${message}
        </div>
        <div style="margin: 10px 0; font-size: 1.1rem; line-height: 1.4;">
            ${details}
        </div>
        <div style="color: #666; margin-top: 8px; font-size: 1rem;">
            Score: <strong>${result.score}%</strong>
        </div>
        ${suggestion ? `<div style="margin-top: 12px; padding: 8px; background: ${color}22; border-radius: 5px; font-size: 0.9rem; color: #555;">
            ${suggestion}
        </div>` : ''}
    `;
    feedbackElement.className = 'feedback';
    feedbackElement.style.display = 'block';
}

        // *** AUDIO ELEMZ√âS ***

        // SZ√ìV√ÅLASZT√ÅS
        function selectRandomWords(count) {
            if (count === 0 || count >= fullWordDictionary.length) {
                selectedWords = [...fullWordDictionary];
            } else {
                const shuffled = [...fullWordDictionary].sort(() => 0.5 - Math.random());
                selectedWords = shuffled.slice(0, count);
            }
            currentWordIndex = 0;
        }

        // SZ√ì MEGJELEN√çT√âSE
        function displayWord() {
            const currentWord = selectedWords[currentWordIndex];
            chineseWordElement.textContent = currentWord.english;
            pinyinElement.textContent = currentWord.pinyin;
            meaningElement.textContent = currentWord.meaning;
            
            const progressText = `${currentWordIndex + 1}/${selectedWords.length}`;
            progressElement.textContent = progressText;
            const progressPercent = ((currentWordIndex + 1) / selectedWords.length) * 100;
            progressFill.style.width = `${progressPercent}%`;
            
            feedbackElement.style.display = 'none';
            recordingStatus.textContent = 'Click "Start Recording", speak, then "Analyze"';
            recordButton.disabled = false;
            stopButton.disabled = true;
            analyzeButton.disabled = true;
            recordButton.classList.remove('recording');
 	   
            visualizer.style.display = 'none';
        }

        // GYAKORL√ÅS IND√çT√ÅSA
        function startPractice() {
            selectRandomWords(selectedWordCount);
            settingsSection.classList.add('hidden');
            wordSection.classList.remove('hidden');
            recordingSection.classList.remove('hidden');
            controlsSection.classList.remove('hidden');
            progressSection.classList.remove('hidden');
            displayWord();
        }

        // ANGOL SZ√ì FELOLVAS√ÅSA
        function speakEnglish() {
            const currentWord = selectedWords[currentWordIndex];
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(currentWord.english);
                speech.lang = 'en-US';
                speech.rate = 0.8;
                window.speechSynthesis.speak(speech);
            }
        }

        function updatePracticeInfo() {
            const totalWords = fullWordDictionary.length;
            document.getElementById('total-words').textContent = totalWords;
        }

        // ALKALMAZ√ÅS IND√çT√ÅSA
        init();
        console.log("üéØ Pronunciation practice loaded successfully!");
    </script>
</body>
</html>
